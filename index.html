<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La pelea por no descender - Liga Profesional</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a101f;
            background-image: url('https://www.ligaprofesional.ar/wp-content/uploads/2025/03/Fondo-Home-grande-5.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .main-container {
            background-color: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Definitive Button Styles */
        .tab-btn, .team-filter-btn {
            background-color: rgba(30, 41, 59, 0.7); /* bg-slate-800/70 */
            border: 1px solid #475569; /* border-slate-600 */
            color: #FFFFFF; /* White text */
            font-size: 1rem; /* Larger font size */
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .tab-btn:hover, .team-filter-btn:hover {
            background-color: #475569; /* bg-slate-600 */
            border-color: #64748b; /* border-slate-500 */
        }
        .tab-btn.active, .team-filter-btn.active {
            background-color: #FFFFFF;
            color: #1e3a8a; /* text-blue-800 */
            font-weight: 700;
            transform: scale(1.05);
            border-color: #FFFFFF;
        }

        .color-indicator {
            width: 1rem;
            height: 1rem;
            border-radius: 9999px;
            margin-right: 0.5rem;
            border: 1px solid #4A5568;
            flex-shrink: 0;
        }
        .color-stripes { background-image: linear-gradient(to right, var(--color1) 50%, var(--color2) 50%); }
        .team-color-single { background-color: var(--color1); }
        .color-triple-stripes { background-image: linear-gradient(to right, var(--color1) 33.3%, var(--color2) 33.3%, var(--color2) 66.6%, var(--color3) 66.6%); }
        .color-diagonal-stripe { background: linear-gradient(135deg, var(--color1) 0%, var(--color1) 40%, var(--color2) 40%, var(--color2) 60%, var(--color1) 60%, var(--color1) 100%); }
        .color-vertical-stripes { background-image: repeating-linear-gradient(to right, var(--color1) 0, var(--color1) 3px, var(--color2) 3px, var(--color2) 4px); }
        .color-horizontal-stripe { background-image: linear-gradient(to bottom, var(--color1) 0%, var(--color1) 33%, var(--color2) 33%, var(--color2) 67%, var(--color1) 67%, var(--color1) 100%); }
        .color-chevron { background-color: var(--color1); position: relative; overflow: hidden; }
        .color-chevron::before { content: ''; position: absolute; width: 100%; height: 100%; top: 0; left: 0; background-color: var(--color2); clip-path: polygon(0 0, 20% 0, 50% 60%, 80% 0, 100% 0, 50% 100%); }
        .color-five-stripes { background-image: linear-gradient(to right, var(--color1) 0%, var(--color1) 20%, var(--color2) 20%, var(--color2) 40%, var(--color1) 40%, var(--color1) 60%, var(--color2) 60%, var(--color2) 80%, var(--color1) 80%, var(--color1) 100%); }
        
        .details-panel { @apply bg-slate-900 text-white; }
        
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        @media (max-width: 640px) {
            .table-custom-header, #fixture-body tr, #annual-table-body tr { font-size: 0.7rem; }
            th, td { padding-left: 0.25rem; padding-right: 0.25rem; }
            .team-filter-btn, .tab-btn { padding: 0.5rem; font-size: 0.75rem; }
            h1 { font-size: 1.25rem; }
            p { font-size: 0.875rem; }
        }
    </style>
</head>
<body class="bg-slate-900 flex items-center justify-center min-h-screen p-2 sm:p-4">

    <!-- Main Container -->
    <div class="w-full max-w-4xl main-container shadow-2xl rounded-xl overflow-hidden p-4 sm:p-6">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-white my-4">La pelea por no descender - Liga Profesional</h1>
        <p class="text-sm sm:text-base text-center text-slate-400 mb-6">Explora el fixture, anota resultados y ve cómo cambia la tabla anual.</p>

        <!-- Tab Buttons -->
        <div class="flex flex-col sm:flex-row gap-2 justify-center mb-6">
            <button class="tab-btn" onclick="showTab('fixture-container', this)">Fixture</button>
            <button class="tab-btn" onclick="showTab('annual-table-container', this)">Tabla Anual</button>
        </div>

        <!-- Fixture Container -->
        <div id="fixture-container" class="tab-content">
            <div id="filter-buttons-container" class="flex flex-wrap gap-2 justify-center mb-6"></div>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header">
                        <th class="rounded-tl-lg text-left text-slate-300">Local</th>
                        <th class="text-center w-32 text-slate-300">Resultado</th>
                        <th class="text-right text-slate-300">Visitante</th>
                        <th class="text-center w-24 text-slate-300">Fecha</th>
                        <th class="text-center w-20 text-slate-300">Hora</th>
                        <th class="rounded-tr-lg text-center w-16 text-slate-300">Detalles</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700" id="fixture-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Annual Table Container -->
        <div id="annual-table-container" class="tab-content hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header text-sm">
                        <th class="rounded-tl-lg text-center text-slate-300">Pos</th>
                        <th class="text-left text-slate-300">Equipo</th>
                        <th class="text-center text-slate-300">Pts</th>
                        <th class="text-center text-slate-300">PJ</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PG</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PE</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PP</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GF</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GC</th>
                        <th class="rounded-tr-lg text-center text-slate-300">DG</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700 text-sm" id="annual-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- LOCAL STATE & STATIC DATA ---
        const teamColors = {
            'Talleres': { initials: 'TAL', primary: '#001F5B', secondary: '#FFFFFF', type: 'five-stripes' },
            'Sarmiento': { initials: 'SAR', primary: '#007F3F', secondary: '#FFFFFF', type: 'single' },
            'San Martín SJ': { initials: 'SSJ', primary: '#2D8C3F', secondary: '#000000', type: 'stripes' },
            'Aldosivi': { initials: 'ALD', primary: '#008060', secondary: '#FCD116', type: 'stripes' },
            'Godoy Cruz': { initials: 'GC', primary: '#318CE7', secondary: '#FFFFFF', type: 'vertical-stripes' },
            'Barracas Central': { initials: 'BAR', primary: '#E31C25', secondary: '#FFFFFF', tertiary: '#E31C25', type: 'triple-stripes' },
            'Instituto': { initials: 'INS', primary: '#E31C25', secondary: '#FFFFFF', type: 'stripes' },
            'San Lorenzo': { initials: 'SL', primary: '#181C5C', secondary: '#E31C25', type: 'stripes' },
            'Independiente': { initials: 'IND', primary: '#E31C25', secondary: '#FFFFFF', type: 'single' },
            'Independiente Rivadavia': { initials: 'IRI', primary: '#003E99', secondary: '#FFFFFF', type: 'single' },
            'Lanús': { initials: 'LAN', primary: '#7B1327', secondary: '#FFFFFF', type: 'single' },
            'Atlético Tucumán': { initials: 'ATU', primary: '#0060A0', secondary: '#FFFFFF', type: 'stripes' },
            'Deportivo Riestra': { initials: 'RIE', primary: '#000000', secondary: '#FFFFFF', type: 'stripes' },
            'Tigre': { initials: 'TIG', primary: '#002255', secondary: '#E31C25', type: 'stripes' },
            'Rosario Central': { initials: 'RC', primary: '#002D72', secondary: '#FCD116', type: 'stripes' },
            'Belgrano': { initials: 'BEL', primary: '#7AC0D8', secondary: '#000000', type: 'single' },
            'River Plate': { initials: 'RIV', primary: '#FFFFFF', secondary: '#E81A24', type: 'diagonal-stripe' },
            'Vélez Sarsfield': { initials: 'VEL', primary: '#FFFFFF', secondary: '#00366D', type: 'chevron' },
            'Platense': { initials: 'PLA', primary: '#5C4A42', secondary: '#FFFFFF', type: 'stripes' },
            'Argentinos Jrs': { initials: 'ARG', primary: '#E31C25', secondary: '#FFFFFF', type: 'single' },
            'Unión': { initials: 'UNI', primary: '#E81C28', secondary: '#FFFFFF', type: 'stripes' },
            'Huracán': { initials: 'HUR', primary: '#FFFFFF', secondary: '#FFFFFF', type: 'single' },
            'Estudiantes': { initials: 'EST', primary: '#E31C25', secondary: '#FFFFFF', type: 'stripes' },
            'Defensa y Justicia': { initials: 'DYJ', primary: '#009943', secondary: '#FCD116', type: 'stripes' },
            'Gimnasia': { initials: 'GIM', primary: '#FFFFFF', secondary: '#0033A0', type: 'horizontal-stripe' },
            'Central Córdoba': { initials: 'CEN', primary: '#000000', secondary: '#FFFFFF', type: 'stripes'},
            'Newell\'s': { initials: 'NOB', primary: '#E31C25', secondary: '#000000', type: 'stripes' },
            'Banfield': { initials: 'BAN', primary: '#008037', secondary: '#FFFFFF', type: 'stripes' },
            'Boca Jrs.': { initials: 'BOC', primary: '#003472', secondary: '#FDB913', type: 'horizontal-stripe' },
            'Racing': { initials: 'RAC', primary: '#75AADB', secondary: '#FFFFFF', type: 'vertical-stripes' }
        };
        
        const allMatches = [
            { id: 1, home: 'Godoy Cruz', away: 'Barracas Central', date: '13/09', time: '12:30', jornada: 8, result: null }, { id: 2, home: 'Sarmiento', away: 'Aldosivi', date: '13/09', time: '19:15', jornada: 8, result: null }, { id: 3, home: 'Tigre', away: 'Talleres', date: '14/09', time: '18:00', jornada: 8, result: null }, { id: 31, home: 'Belgrano', away: 'San Martín SJ', date: '14/09', time: '15:00', jornada: 8, result: '0-0', isHistorical: true }, { id: 4, home: 'San Martín SJ', away: 'Vélez Sarsfield', date: '19/09', time: '17:15', jornada: 9, result: null }, { id: 5, home: 'Barracas Central', away: 'Sarmiento', date: '20/09', time: '12:30', jornada: 9, result: null }, { id: 6, home: 'Tigre', away: 'Aldosivi', date: '20/09', time: '17:00', jornada: 9, result: null }, { id: 7, home: 'Godoy Cruz', away: 'Instituto', date: '21/09', time: '14:45', jornada: 9, result: null }, { id: 8, home: 'Rosario Central', away: 'Talleres', date: '21/09', time: '17:00', jornada: 9, result: null }, { id: 9, home: 'Platense', away: 'San Martín SJ', date: '26/09', time: '20:00', jornada: 10, result: null }, { id: 10, home: 'Aldosivi', away: 'Argentinos Jrs', date: '27/09', time: '12:30', jornada: 10, result: null }, { id: 11, home: 'San Lorenzo', away: 'Godoy Cruz', date: '27/09', time: '14:45', jornada: 10, result: null }, { id: 12, home: 'Talleres', away: 'Sarmiento', date: '27/09', time: '19:15', jornada: 10, result: null }, { id: 13, home: 'Godoy Cruz', away: 'Independiente', date: '05/10', time: '12:00', jornada: 11, result: null }, { id: 14, home: 'Talleres', away: 'Belgrano', date: '05/10', time: '17:00', jornada: 11, result: null }, { id: 15, home: 'Sarmiento', away: 'Gimnasia', date: '05/10', time: '17:00', jornada: 11, result: null }, { id: 32, home: 'San Martín SJ', away: 'Instituto', date: '06/10', time: '19:00', jornada: 11, result: null }, { id: 33, home: 'Unión', away: 'Aldosivi', date: '07/10', time: '21:00', jornada: 11, result: null }, { id: 16, home: 'Independiente Rivadavia', away: 'Godoy Cruz', date: '12/10', time: '12:00', jornada: 12, result: null }, { id: 17, home: 'Aldosivi', away: 'Huracán', date: '12/10', time: '17:00', jornada: 12, result: null }, { id: 18, home: 'Gimnasia', away: 'Talleres', date: '12/10', time: '20:00', jornada: 12, result: null }, { id: 34, home: 'River Plate', away: 'Sarmiento', date: '13/10', time: '21:00', jornada: 12, result: null }, { id: 35, home: 'San Lorenzo', away: 'San Martín SJ', date: '14/10', time: '17:00', jornada: 12, result: null }, { id: 19, home: 'Lanús', away: 'Godoy Cruz', date: '19/10', time: '17:00', jornada: 13, result: null }, { id: 20, home: 'Sarmiento', away: 'Vélez Sarsfield', date: '19/10', time: '17:00', jornada: 13, result: null }, { id: 21, home: 'Talleres', away: 'River Plate', date: '19/10', time: '21:00', jornada: 13, result: null }, { id: 36, home: 'Independiente', away: 'San Martín SJ', date: '20/10', time: '19:00', jornada: 13, result: null }, { id: 37, home: 'Defensa y Justicia', away: 'Aldosivi', date: '21/10', time: '17:00', jornada: 13, result: null }, { id: 22, home: 'Godoy Cruz', away: 'San Martín SJ', date: '26/10', time: '19:00', jornada: 14, result: null }, { id: 23, home: 'Vélez Sarsfield', away: 'Talleres', date: '26/10', time: '19:00', jornada: 14, result: null }, { id: 24, home: 'Platense', away: 'Sarmiento', date: '26/10', time: '19:00', jornada: 14, result: null }, { id: 38, home: 'Aldosivi', away: 'Estudiantes', date: '27/10', time: '17:00', jornada: 14, result: null }, { id: 25, home: 'Atlético Tucumán', away: 'Godoy Cruz', date: '02/11', time: '20:00', jornada: 15, result: null }, { id: 26, home: 'Talleres', away: 'Platense', date: '02/11', time: '17:00', jornada: 15, result: null }, { id: 27, home: 'Sarmiento', away: 'Instituto', date: '02/11', time: '17:00', jornada: 15, result: null }, { id: 39, home: 'Lanús', away: 'San Martín SJ', date: '03/11', time: '19:00', jornada: 15, result: null }, { id: 40, home: 'Rosario Central', away: 'Aldosivi', date: '04/11', time: '21:00', jornada: 15, result: null }, { id: 28, home: 'Deportivo Riestra', away: 'Godoy Cruz', date: '09/11', time: '17:00', jornada: 16, result: null }, { id: 29, home: 'Instituto', away: 'Talleres', date: '09/11', time: '17:00', jornada: 16, result: null }, { id: 30, home: 'Aldosivi', away: 'San Martín SJ', date: '09/11', time: '20:00', jornada: 16, result: null }, { id: 41, home: 'San Lorenzo', away: 'Sarmiento', date: '10/11', time: '19:00', jornada: 16, result: null },
        ];
        
        let initialAnnualTableData = [
            { pos: 1, team: 'River Plate', pts: 46, pj: 23, pg: 12, pe: 10, pp: 1, gf: 35, gc: 13, dg: 22 }, { pos: 2, team: 'Boca Jrs.', pts: 45, pj: 23, pg: 13, pe: 6, pp: 4, gf: 33, gc: 14, dg: 19 }, { pos: 3, team: 'Rosario Central', pts: 45, pj: 22, pg: 12, pe: 9, pp: 1, gf: 26, gc: 10, dg: 16 }, { pos: 4, team: 'Argentinos Jrs', pts: 41, pj: 23, pg: 11, pe: 8, pp: 4, gf: 31, gc: 15, dg: 16 }, { pos: 5, team: 'Deportivo Riestra', pts: 40, pj: 24, pg: 10, pe: 10, pp: 4, gf: 24, gc: 12, dg: 12 }, { pos: 6, team: 'San Lorenzo', pts: 40, pj: 24, pg: 10, pe: 10, pp: 4, gf: 19, gc: 13, dg: 6 }, { pos: 7, team: 'Barracas Central', pts: 40, pj: 23, pg: 11, pe: 7, pp: 5, gf: 31, gc: 26, dg: 5 }, { pos: 8, team: 'Huracán', pts: 39, pj: 24, pg: 10, pe: 9, pp: 5, gf: 24, gc: 18, dg: 6 }, { pos: 9, team: 'Tigre', pts: 35, pj: 23, pg: 10, pe: 5, pp: 8, gf: 24, gc: 19, dg: 5 }, { pos: 10, team: 'Independiente Rivadavia', pts: 35, pj: 23, pg: 9, pe: 8, pp: 6, gf: 28, gc: 26, dg: 2 }, { pos: 11, team: 'Racing', pts: 33, pj: 24, pg: 10, pe: 3, pp: 11, gf: 32, gc: 28, dg: 4 }, { pos: 12, team: 'Estudiantes', pts: 33, pj: 23, pg: 9, pe: 6, pp: 8, gf: 26, gc: 27, dg: -1 }, { pos: 13, team: 'Independiente', pts: 32, pj: 22, pg: 8, pe: 8, pp: 6, gf: 27, gc: 19, dg: 8 }, { pos: 14, team: 'Central Córdoba', pts: 31, pj: 24, pg: 8, pe: 7, pp: 9, gf: 31, gc: 28, dg: 3 }, { pos: 15, team: 'Defensa y Justicia', pts: 31, pj: 23, pg: 8, pe: 7, pp: 8, gf: 26, gc: 27, dg: -1 }, { pos: 16, team: 'Lanús', pts: 30, pj: 23, pg: 7, pe: 9, pp: 7, gf: 19, gc: 18, dg: 1 }, { pos: 17, team: 'Platense', pts: 29, pj: 22, pg: 7, pe: 8, pp: 7, gf: 18, gc: 19, dg: -1 }, { pos: 18, team: 'Vélez Sarsfield', pts: 29, pj: 24, pg: 8, pe: 5, pp: 11, gf: 16, gc: 25, dg: -9 }, { pos: 19, team: 'Unión', pts: 26, pj: 23, pg: 6, pe: 8, pp: 9, gf: 21, gc: 22, dg: -1 }, { pos: 20, team: 'Gimnasia', pts: 26, pj: 23, pg: 7, pe: 5, pp: 11, gf: 14, gc: 23, dg: -9 }, { pos: 21, team: 'Belgrano', pts: 26, pj: 24, pg: 5, pe: 11, pp: 8, gf: 19, gc: 30, dg: -11 }, { pos: 22, team: 'Atlético Tucumán', pts: 25, pj: 23, pg: 7, pe: 4, pp: 12, gf: 25, gc: 27, dg: -2 }, { pos: 23, team: 'Newell\'s', pts: 25, pj: 23, pg: 6, pe: 7, pp: 10, gf: 18, gc: 23, dg: -5 }, { pos: 24, team: 'Banfield', pts: 24, pj: 23, pg: 6, pe: 6, pp: 11, gf: 22, gc: 29, dg: -7 }, { pos: 25, team: 'Instituto', pts: 24, pj: 23, pg: 6, pe: 6, pp: 11, gf: 18, gc: 30, dg: -12 }, { pos: 26, team: 'Godoy Cruz', pts: 23, pj: 23, pg: 4, pe: 11, pp: 8, gf: 15, gc: 28, dg: -13 }, { pos: 27, team: 'Sarmiento', pts: 21, pj: 22, pg: 3, pe: 12, pp: 7, gf: 16, gc: 28, dg: -12 }, { pos: 28, team: 'Talleres', pts: 18, pj: 23, pg: 3, pe: 9, pp: 11, gf: 14, gc: 23, dg: -9 }, { pos: 29, team: 'San Martín SJ', pts: 18, pj: 24, pg: 4, pe: 6, pp: 14, gf: 10, gc: 25, dg: -15 }, { pos: 30, team: 'Aldosivi', pts: 18, pj: 23, pg: 4, pe: 6, pp: 13, gf: 19, gc: 36, dg: -17 },
        ];
        
        let annualTableData = [];
        let baseTableForSim;
        const headerTeams = ['Talleres', 'Sarmiento', 'San Martín SJ', 'Aldosivi', 'Godoy Cruz'];

        // --- UTILS ---
        const getTeamInitials = (teamName) => teamColors[teamName]?.initials || teamName;
        const getDayOfWeek = (dateString) => { const [d, m] = dateString.split('/'); const date = new Date(new Date().getFullYear(), m - 1, d); return isNaN(date.getTime()) ? '' : ['DOM','LUN','MAR','MIÉ','JUE','VIE','SÁB'][date.getDay()]; };
        const getTeamColorDiv = (teamName) => {
            const c = teamColors[teamName]; if (!c) return `<div class="color-indicator" style="background-color: transparent; border: 1px solid #ccc;"></div>`;
            const style = `--color1: ${c.primary}; --color2: ${c.secondary};` + (c.tertiary ? ` --color3: ${c.tertiary};` : '');
            return `<div class="color-indicator ${c.type === 'single' ? 'team-color-single' : `color-${c.type}`}" style="${style}"></div>`;
        };
        const renderTeamDisplay = (teamName, alignClass = '', isFixture = false) => {
            const fontSizeClass = isFixture ? 'text-lg' : 'text-sm';
            return `<div class="flex items-center gap-2 ${alignClass}">${getTeamColorDiv(teamName)}<span class="font-bold ${fontSizeClass} text-white">${getTeamInitials(teamName)}</span></div>`;
        };
        
        // --- RENDER FUNCTIONS ---
        const renderFilterButtons = () => {
            const container = document.getElementById('filter-buttons-container');
            let buttonsHTML = `<button class="team-filter-btn" onclick="filterMatches('All')">Todos</button>`;
            headerTeams.forEach(team => {
                buttonsHTML += `<button class="team-filter-btn flex items-center justify-center" onclick="filterMatches('${team}')">${getTeamColorDiv(team)}${getTeamInitials(team)}</button>`;
            });
            container.innerHTML = buttonsHTML;
        };

        const renderMatches = (matchesToRender) => {
            const body = document.getElementById('fixture-body'); body.innerHTML = '';
            if (matchesToRender.length === 0) { body.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-slate-400">No hay partidos para mostrar.</td></tr>`; return; }
            const grouped = matchesToRender.reduce((acc, m) => { (acc[`Fecha ${m.jornada}`] = acc[`Fecha ${m.jornada}`] || []).push(m); return acc; }, {});
            Object.keys(grouped).sort((a, b) => parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1])).forEach(jornada => {
                const titleRow = body.insertRow(); titleRow.innerHTML = `<td colspan="6" class="px-2 py-2 font-bold text-white bg-slate-800">${jornada}</td>`;
                grouped[jornada].forEach(match => {
                    const isHeaderMatch = headerTeams.includes(match.home) && headerTeams.includes(match.away);
                    const row = body.insertRow();
                    row.className = 'hover:bg-slate-800/60 cursor-pointer' + (isHeaderMatch ? ' bg-blue-900/40' : '');
                    row.setAttribute('onclick', `event.target.tagName.toLowerCase() !== 'input' && toggleDetails('details-${match.id}')`);
                    const homeScore = match.result ? match.result.split('-')[0] : '';
                    const awayScore = match.result ? match.result.split('-')[1] : '';
                    row.innerHTML = `
                        <td class="py-3 text-left text-slate-300">${renderTeamDisplay(match.home, '', true)}</td>
                        <td class="py-3 text-center">
                           <div class="flex justify-center items-center gap-1">
                                <input id="home-score-${match.id}" type="number" min="0" value="${homeScore}" oninput="updateResult(${match.id})"
                                       class="w-10 h-10 p-2 text-center font-bold text-lg border-2 border-slate-600 rounded-md bg-slate-900 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <input id="away-score-${match.id}" type="number" min="0" value="${awayScore}" oninput="updateResult(${match.id})"
                                       class="w-10 h-10 p-2 text-center font-bold text-lg border-2 border-slate-600 rounded-md bg-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </td>
                        <td class="py-3 text-right text-slate-300">${renderTeamDisplay(match.away, 'justify-end', true)}</td>
                        <td class="py-3 text-center text-slate-400">${getDayOfWeek(match.date)} ${match.date}</td>
                        <td class="py-3 text-center text-slate-400">${match.time}</td>
                        <td class="py-3 text-center text-slate-400 text-lg">&#9662;</td>
                    `;
                    const detailsRow = body.insertRow();
                    detailsRow.id = `details-${match.id}`;
                    detailsRow.className = 'hidden';
                    detailsRow.innerHTML = `<td colspan="6" class="px-6 py-4 details-panel"><h4 class="font-bold mb-2">Detalles del Partido</h4><p><strong>Partido:</strong> ${match.home} vs ${match.away}</p><p><strong>Torneo:</strong> Liga Profesional</p></td>`;
                });
            });
        };

        const renderAnnualTable = () => {
            const body = document.getElementById('annual-table-body'); body.innerHTML = '';
            annualTableData.sort((a, b) => b.pts - a.pts || (b.dg - a.dg) || (b.gf - a.gf));
            const descendingTeams = [...annualTableData].slice(-2).map(t => t.team);
            annualTableData.forEach((team, index) => {
                const row = body.insertRow();
                let rowClass = '';
                if (index <= 2) { rowClass = 'bg-yellow-500/10'; } 
                else if (index >= 3 && index <= 8) { rowClass = 'bg-gray-500/10'; }
                if (descendingTeams.includes(team.team)) { rowClass = 'bg-red-900/40 text-red-300';}
                row.className = rowClass;
                const dgClass = team.dg > 0 ? 'text-green-400' : (team.dg < 0 ? 'text-red-400' : 'text-slate-400');
                row.innerHTML = `
                    <td class="px-2 py-3 font-semibold text-center text-slate-400">${index + 1}</td>
                    <td class="px-2 py-3 text-left text-slate-300">${renderTeamDisplay(team.team)}</td>
                    <td class="px-2 py-3 font-bold text-center text-white">${team.pts}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.pj}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pg}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pe}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pp}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gf}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gc}</td>
                    <td class="px-2 py-3 font-semibold text-center ${dgClass}">${team.dg}</td>
                `;
            });
        };

        // --- LOGIC & EVENT HANDLERS ---
        window.updateResult = (matchId) => {
            const match = allMatches.find(m => m.id == matchId);
            if (!match) return;
            const homeScore = document.getElementById(`home-score-${match.id}`).value;
            const awayScore = document.getElementById(`away-score-${match.id}`).value;
            if (homeScore.trim() !== '' && awayScore.trim() !== '') {
                match.result = `${homeScore}-${awayScore}`;
            } else {
                match.result = null;
            }
            recalculateTable();
        };
        
        const recalculateTable = () => {
            // Start with a deep copy of the base table data
            let tempTable = JSON.parse(JSON.stringify(baseTableForSim));
            
            // Apply the results of all matches in the fixture
            allMatches.forEach(match => {
                if (match.result) { 
                    const [homeScore, awayScore] = match.result.split('-').map(Number);
                    const homeTeam = tempTable.find(t => t.team === match.home);
                    const awayTeam = tempTable.find(t => t.team === match.away);
                    if (homeTeam && awayTeam) {
                        homeTeam.pj += 1; awayTeam.pj += 1;
                        homeTeam.gf += homeScore; awayTeam.gf += awayScore;
                        homeTeam.gc += awayScore; awayTeam.gc += homeScore;
                        if (homeScore > awayScore) { homeTeam.pg += 1; homeTeam.pts += 3; awayTeam.pp += 1; } 
                        else if (awayScore > homeScore) { awayTeam.pg += 1; awayTeam.pts += 3; homeTeam.pp += 1; } 
                        else { homeTeam.pe += 1; awayTeam.pe += 1; homeTeam.pts += 1; awayTeam.pts += 1; }
                    }
                }
            });
            
            tempTable.forEach(team => { team.dg = team.gf - team.gc; });
            annualTableData = tempTable;
            renderAnnualTable();
        };
        
        window.toggleDetails = (id) => document.getElementById(id)?.classList.toggle('hidden');
        window.filterMatches = (team) => {
            document.querySelectorAll('.team-filter-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.team-filter-btn[onclick="filterMatches('${team}')"]`);
            if(btn) btn.classList.add('active');
            const filtered = (team === 'All') ? allMatches : allMatches.filter(m => m.home === team || m.away === team);
            renderMatches(filtered);
        };
        window.showTab = (tabId, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('active'); });
            btn.classList.add('active');
        };
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // This is our true starting point for simulations, a deep copy.
            baseTableForSim = JSON.parse(JSON.stringify(initialAnnualTableData));
            
            // Adjust the base data by REMOVING the stats of any historical matches,
            // because the recalculateTable function will add them back in.
            allMatches.filter(m => m.isHistorical).forEach(match => {
                const homeTeam = baseTableForSim.find(t => t.team === match.home);
                const awayTeam = baseTableForSim.find(t => t.team === match.away);
                 if(homeTeam && awayTeam){
                    const [homeScore, awayScore] = match.result.split('-').map(Number);
                     homeTeam.pj -= 1; awayTeam.pj -= 1;
                     homeTeam.gf -= homeScore; awayTeam.gf -= awayScore;
                     homeTeam.gc -= awayScore; awayTeam.gc -= homeScore;
                     if (homeScore > awayScore) { homeTeam.pg -= 1; homeTeam.pts -= 3; awayTeam.pp -= 1; } 
                     else if (awayScore > homeScore) { awayTeam.pg -= 1; awayTeam.pts -= 3; homeTeam.pp -= 1; } 
                     else { homeTeam.pe -= 1; awayTeam.pe -= 1; homeTeam.pts -= 1; awayTeam.pts -= 1; }
                }
            });

            renderFilterButtons();
            recalculateTable(); // Initial calculation
            renderMatches(allMatches);

            const fixtureTabBtn = document.querySelector('.tab-btn');
            showTab('fixture-container', fixtureTabBtn);
            filterMatches('All');
        });
    </script>
</body>
</html>

