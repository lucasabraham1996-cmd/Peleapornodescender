<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La pelea por no descender - Liga Profesional</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a101f;
            background-image: url('https://www.ligaprofesional.ar/wp-content/uploads/2025/03/Fondo-Home-grande-5.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .main-container {
            background-color: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Definitive Button Styles */
        .tab-btn, .team-filter-btn, .sub-tab-btn, .action-btn {
            background-color: rgba(30, 41, 59, 0.7); /* bg-slate-800/70 */
            border: 1px solid #475569; /* border-slate-600 */
            color: #FFFFFF; /* White text */
            font-size: 1rem; /* Larger font size */
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .tab-btn:hover, .team-filter-btn:hover, .sub-tab-btn:hover, .action-btn:hover {
            background-color: #475569; /* bg-slate-600 */
            border-color: #64748b; /* border-slate-500 */
        }
        .tab-btn.active, .team-filter-btn.active, .sub-tab-btn.active {
            background-color: #FFFFFF;
            color: #1e3a8a; /* text-blue-800 */
            font-weight: 700;
            transform: scale(1.05);
            border-color: #FFFFFF;
        }
        .restore-btn { background-color: #991b1b; border-color: #f87171; }
        .save-btn { background-color: #166534; border-color: #4ade80; }

        .color-indicator {
            width: 1rem;
            height: 1rem;
            border-radius: 9999px;
            margin-right: 0.5rem;
            border: 1px solid #4A5568;
            flex-shrink: 0;
        }
        .color-stripes { background-image: linear-gradient(to right, var(--color1) 50%, var(--color2) 50%); }
        .team-color-single { background-color: var(--color1); }
        .color-triple-stripes { background-image: linear-gradient(to right, var(--color1) 33.3%, var(--color2) 33.3%, var(--color2) 66.6%, var(--color3) 66.6%); }
        .color-diagonal-stripe { background: linear-gradient(135deg, var(--color1) 0%, var(--color1) 40%, var(--color2) 40%, var(--color2) 60%, var(--color1) 60%, var(--color1) 100%); }
        .color-vertical-stripes { background-image: repeating-linear-gradient(to right, var(--color1) 0, var(--color1) 3px, var(--color2) 3px, var(--color2) 4px); }
        .color-horizontal-stripe { background-image: linear-gradient(to bottom, var(--color1) 0%, var(--color1) 33%, var(--color2) 33%, var(--color2) 67%, var(--color1) 67%, var(--color1) 100%); }
        .color-chevron { background-color: var(--color1); position: relative; overflow: hidden; }
        .color-chevron::before { content: ''; position: absolute; width: 100%; height: 100%; top: 0; left: 0; background-color: var(--color2); clip-path: polygon(0 0, 20% 0, 50% 60%, 80% 0, 100% 0, 50% 100%); }
        .color-five-stripes { background-image: linear-gradient(to right, var(--color1) 0%, var(--color1) 20%, var(--color2) 20%, var(--color2) 40%, var(--color1) 40%, var(--color1) 60%, var(--color2) 60%, var(--color2) 80%, var(--color1) 80%, var(--color1) 100%); }
        
        .details-panel { @apply bg-white text-slate-800; }
        
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        @media (max-width: 640px) {
            .table-custom-header, #fixture-body tr, #annual-table-body tr, #promedios-table-body tr, #talleres-table-body tr { font-size: 0.7rem; }
            th, td { padding-left: 0.25rem; padding-right: 0.25rem; }
            .team-filter-btn, .tab-btn, .sub-tab-btn, .action-btn { padding: 0.5rem; font-size: 0.75rem; }
            h1 { font-size: 1.25rem; }
            p { font-size: 0.875rem; }
        }
    </style>
</head>
<body class="bg-slate-900 flex items-center justify-center min-h-screen p-2 sm:p-4">

    <!-- Main Container -->
    <div class="w-full max-w-4xl main-container shadow-2xl rounded-xl overflow-hidden p-4 sm:p-6">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-white my-4">La pelea por no descender - Liga Profesional</h1>
        <p class="text-sm sm:text-base text-center text-slate-400 mb-6">Explora el fixture, anota resultados y ve cómo cambian las tablas.</p>

        <!-- Tab Buttons -->
        <div class="flex flex-wrap gap-2 justify-center mb-6">
            <button class="tab-btn" onclick="showTab('fixture-container', this)">Fixture</button>
            <button class="tab-btn" onclick="showTab('annual-table-container', this)">Tabla Anual</button>
            <button class="tab-btn" onclick="showTab('promedios-container', this)">Promedios</button>
            <button class="tab-btn" onclick="showTab('talleres-table-container', this)">Tabla de Talleres</button>
        </div>

        <!-- Fixture Container -->
        <div id="fixture-container" class="tab-content">
            <div class="flex justify-between items-center mb-4">
                <div id="filter-buttons-container" class="flex flex-wrap gap-2 justify-start"></div>
                <div class="flex gap-2">
                    <button class="action-btn save-btn" onclick="saveResults()">Guardar</button>
                    <button class="action-btn restore-btn" onclick="restoreResults()">Restaurar</button>
                </div>
            </div>
             <div id="fixture-sub-tabs-container" class="flex flex-wrap gap-1 justify-center mb-4"></div>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header">
                        <th class="rounded-tl-lg text-left text-slate-300">Local</th>
                        <th class="text-center w-32 text-slate-300">Resultado</th>
                        <th class="text-right text-slate-300">Visitante</th>
                        <th class="text-center w-24 text-slate-300">Fecha</th>
                        <th class="text-center w-20 text-slate-300">Hora</th>
                        <th class="rounded-tr-lg text-center w-16 text-slate-300">Detalles</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700" id="fixture-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Annual Table Container -->
        <div id="annual-table-container" class="tab-content hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header text-sm">
                        <th class="rounded-tl-lg text-center text-slate-300">Pos</th>
                        <th class="text-left text-slate-300">Equipo</th>
                        <th class="text-center text-slate-300">Pts</th>
                        <th class="text-center text-slate-300">PJ</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PG</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PE</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PP</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GF</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GC</th>
                        <th class="rounded-tr-lg text-center text-slate-300">DG</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700 text-sm" id="annual-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Averages Table Container -->
        <div id="promedios-container" class="tab-content hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header text-sm">
                        <th class="rounded-tl-lg text-center text-slate-300">Pos</th>
                        <th class="text-left text-slate-300">Equipo</th>
                        <th class="text-center text-slate-300">Prom</th>
                        <th class="text-center text-slate-300">Pts</th>
                        <th class="text-center text-slate-300">PJ</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">2023</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">2024</th>
                        <th class="rounded-tr-lg text-center text-slate-300">2025</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700 text-sm" id="promedios-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Talleres Table Container -->
        <div id="talleres-table-container" class="tab-content hidden">
             <h2 class="text-xl font-bold text-center text-white mb-4">Últimos 10 Equipos - Tabla Anual</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead class="bg-slate-800/50"><tr class="table-custom-header text-sm">
                        <th class="rounded-tl-lg text-center text-slate-300">Pos</th>
                        <th class="text-left text-slate-300">Equipo</th>
                        <th class="text-center text-slate-300">Pts</th>
                        <th class="text-center text-slate-300">PJ</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PG</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PE</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">PP</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GF</th>
                        <th class="hidden sm:table-cell text-center text-slate-300">GC</th>
                        <th class="rounded-tr-lg text-center text-slate-300">DG</th>
                    </tr></thead>
                    <tbody class="divide-y divide-slate-700 text-sm" id="talleres-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- LOCAL STATE & STATIC DATA ---
        const teamColors = {
            'Talleres': { initials: 'TAL', primary: '#001F5B', secondary: '#FFFFFF', type: 'five-stripes' },
            'Sarmiento': { initials: 'SAR', primary: '#007F3F', secondary: '#FFFFFF', type: 'single' },
            'San Martín SJ': { initials: 'SSJ', primary: '#2D8C3F', secondary: '#000000', type: 'stripes' },
            'Aldosivi': { initials: 'ALD', primary: '#008060', secondary: '#FCD116', type: 'stripes' },
            'Godoy Cruz': { initials: 'GC', primary: '#318CE7', secondary: '#FFFFFF', type: 'vertical-stripes' },
            'Barracas Central': { initials: 'BAR', primary: '#E31C25', secondary: '#FFFFFF', tertiary: '#E31C25', type: 'triple-stripes' },
            'Instituto': { initials: 'INS', primary: '#E31C25', secondary: '#FFFFFF', type: 'stripes' },
            'San Lorenzo': { initials: 'SL', primary: '#181C5C', secondary: '#E31C25', type: 'stripes' },
            'Independiente': { initials: 'IND', primary: '#E31C25', secondary: '#FFFFFF', type: 'single' },
            'Independiente Rivadavia': { initials: 'IRI', primary: '#003E99', secondary: '#FFFFFF', type: 'single' },
            'Lanús': { initials: 'LAN', primary: '#7B1327', secondary: '#FFFFFF', type: 'single' },
            'Atlético Tucumán': { initials: 'ATU', primary: '#0060A0', secondary: '#FFFFFF', type: 'stripes' },
            'Deportivo Riestra': { initials: 'RIE', primary: '#000000', secondary: '#FFFFFF', type: 'stripes' },
            'Tigre': { initials: 'TIG', primary: '#002255', secondary: '#E31C25', type: 'stripes' },
            'Rosario Central': { initials: 'RC', primary: '#002D72', secondary: '#FCD116', type: 'stripes' },
            'Belgrano': { initials: 'BEL', primary: '#7AC0D8', secondary: '#000000', type: 'single' },
            'River Plate': { initials: 'RIV', primary: '#FFFFFF', secondary: '#E81A24', type: 'diagonal-stripe' },
            'Vélez Sarsfield': { initials: 'VEL', primary: '#FFFFFF', secondary: '#00366D', type: 'chevron' },
            'Platense': { initials: 'PLA', primary: '#5C4A42', secondary: '#FFFFFF', type: 'stripes' },
            'Argentinos Jrs': { initials: 'ARG', primary: '#E31C25', secondary: '#FFFFFF', type: 'single' },
            'Unión': { initials: 'UNI', primary: '#E81C28', secondary: '#FFFFFF', type: 'stripes' },
            'Huracán': { initials: 'HUR', primary: '#FFFFFF', secondary: '#FFFFFF', type: 'single' },
            'Estudiantes': { initials: 'EST', primary: '#E31C25', secondary: '#FFFFFF', type: 'stripes' },
            'Defensa y Justicia': { initials: 'DEF', primary: '#009943', secondary: '#FCD116', type: 'stripes' },
            'Gimnasia': { initials: 'GIM', primary: '#FFFFFF', secondary: '#0033A0', type: 'horizontal-stripe' },
            'Central Córdoba': { initials: 'CEN', primary: '#000000', secondary: '#FFFFFF', type: 'stripes'},
            'Newell\'s': { initials: 'NOB', primary: '#E31C25', secondary: '#000000', type: 'stripes' },
            'Banfield': { initials: 'BAN', primary: '#008037', secondary: '#FFFFFF', type: 'stripes' },
            'Boca Jrs.': { initials: 'BOC', primary: '#003472', secondary: '#FDB913', type: 'horizontal-stripe' },
            'Racing': { initials: 'RAC', primary: '#75AADB', secondary: '#FFFFFF', type: 'vertical-stripes' }
        };
        
        let allMatches = [
            // JORNADA 9
            { id: 300, home: 'Deportivo Riestra', away: 'Gimnasia', date: '19/09', time: '17:00', jornada: 9, result: null }, { id: 301, home: 'Huracán', away: 'Racing', date: '19/09', time: '19:00', jornada: 9, result: null }, { id: 4, home: 'San Martín SJ', away: 'Vélez Sarsfield', date: '19/09', time: '19:15', jornada: 9, result: null }, { id: 302, home: 'Lanús', away: 'Platense', date: '19/09', time: '21:15', jornada: 9, result: null }, { id: 5, home: 'Barracas Central', away: 'Sarmiento', date: '20/09', time: '14:30', jornada: 9, result: null }, { id: 303, home: 'Unión', away: 'Independiente Rivadavia', date: '20/09', time: '16:45', jornada: 9, result: null }, { id: 6, home: 'Tigre', away: 'Aldosivi', date: '20/09', time: '19:00', jornada: 9, result: null }, { id: 304, home: 'Atlético Tucumán', away: 'River Plate', date: '20/09', time: '21:15', jornada: 9, result: null }, { id: 305, home: 'Independiente', away: 'San Lorenzo', date: '21/09', time: '14:30', jornada: 9, result: null }, { id: 7, home: 'Godoy Cruz', away: 'Instituto', date: '21/09', time: '16:45', jornada: 9, result: null }, { id: 8, home: 'Rosario Central', away: 'Talleres', date: '21/09', time: '19:00', jornada: 9, result: null }, { id: 306, home: 'Argentinos Jrs', away: 'Banfield', date: '21/09', time: '19:00', jornada: 9, result: null }, { id: 307, home: 'Boca Jrs.', away: 'Central Córdoba', date: '21/09', time: '21:15', jornada: 9, result: null }, { id: 111, home: 'Estudiantes', away: 'Defensa y Justicia', date: '22/09', time: '19:00', jornada: 9, result: null }, { id: 308, home: 'Belgrano', away: 'Newell\'s', date: '22/09', time: '21:00', jornada: 9, result: null },
            
            // JORNADA 10
            { id: 309, home: 'Platense', away: 'San Martín SJ', date: '26/09', time: '19:00', jornada: 10, result: null }, { id: 310, home: 'Banfield', away: 'Unión', date: '26/09', time: '19:00', jornada: 10, result: null }, { id: 311, home: 'Central Córdoba', away: 'Tigre', date: '26/09', time: '21:15', jornada: 10, result: null }, { id: 312, home: 'Gimnasia', away: 'Rosario Central', date: '27/09', time: '14:30', jornada: 10, result: null }, { id: 10, home: 'Aldosivi', away: 'Argentinos Jrs', date: '27/09', time: '14:30', jornada: 10, result: null }, { id: 11, home: 'San Lorenzo', away: 'Godoy Cruz', date: '27/09', time: '16:45', jornada: 10, result: null }, { id: 313, home: 'Defensa y Justicia', away: 'Boca Jrs.', date: '27/09', time: '19:00', jornada: 10, result: null }, { id: 12, home: 'Talleres', away: 'Sarmiento', date: '27/09', time: '21:15', jornada: 10, result: null }, { id: 208, home: 'Racing', away: 'Independiente', date: '28/09', time: '15:15', jornada: 10, result: null }, { id: 314, home: 'River Plate', away: 'Deportivo Riestra', date: '28/09', time: '18:00', jornada: 10, result: null }, { id: 315, home: 'Independiente Rivadavia', away: 'Huracán', date: '28/09', time: '19:30', jornada: 10, result: null }, { id: 316, home: 'Instituto', away: 'Lanús', date: '28/09', time: '20:15', jornada: 10, result: null }, { id: 317, home: 'Barracas Central', away: 'Belgrano', date: '29/09', time: '15:30', jornada: 10, result: null }, { id: 206, home: 'Vélez Sarsfield', away: 'Atlético Tucumán', date: '29/09', time: '20:00', jornada: 10, result: null }, { id: 318, home: 'Newell\'s', away: 'Estudiantes', date: '30/09', time: '19:00', jornada: 10, result: null },

            // JORNADA 11
            { id: 400, home: 'Talleres', away: 'Belgrano', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 401, home: 'Godoy Cruz', away: 'Independiente', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 402, home: 'Lanús', away: 'San Lorenzo', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 403, home: 'San Martín SJ', away: 'Instituto', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 404, home: 'Atlético Tucumán', away: 'Platense', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 405, home: 'Deportivo Riestra', away: 'Vélez Sarsfield', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 15, home: 'Sarmiento', away: 'Gimnasia', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 406, home: 'Rosario Central', away: 'River Plate', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 407, home: 'Huracán', away: 'Banfield', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 408, home: 'Racing', away: 'Independiente Rivadavia', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 33, home: 'Unión', away: 'Aldosivi', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 409, home: 'Argentinos Jrs', away: 'Central Córdoba', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 410, home: 'Tigre', away: 'Defensa y Justicia', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 411, home: 'Boca Jrs.', away: 'Newell\'s', date: '05/10', time: '14:00', jornada: 11, result: null }, { id: 412, home: 'Estudiantes', away: 'Barracas Central', date: '05/10', time: '14:00', jornada: 11, result: null },

            // JORNADA 12
            { id: 16, home: 'Independiente Rivadavia', away: 'Godoy Cruz', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 413, home: 'Vélez Sarsfield', away: 'Rosario Central', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 18, home: 'Gimnasia', away: 'Talleres', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 414, home: 'Platense', away: 'Deportivo Riestra', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 34, home: 'River Plate', away: 'Sarmiento', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 32, home: 'Instituto', away: 'Atlético Tucumán', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 35, home: 'San Lorenzo', away: 'San Martín SJ', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 415, home: 'Belgrano', away: 'Estudiantes', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 416, home: 'Independiente', away: 'Lanús', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 417, home: 'Barracas Central', away: 'Boca Jrs.', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 418, home: 'Defensa y Justicia', away: 'Argentinos Jrs', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 419, home: 'Newell\'s', away: 'Tigre', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 420, home: 'Central Córdoba', away: 'Unión', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 17, home: 'Aldosivi', away: 'Huracán', date: '12/10', time: '14:00', jornada: 12, result: null }, { id: 421, home: 'Banfield', away: 'Racing', date: '12/10', time: '14:00', jornada: 12, result: null },

            // JORNADA 13
            { id: 422, home: 'Estudiantes', away: 'Gimnasia', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 19, home: 'Lanús', away: 'Godoy Cruz', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 36, home: 'San Martín SJ', away: 'Independiente', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 423, home: 'Atlético Tucumán', away: 'San Lorenzo', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 20, home: 'Sarmiento', away: 'Vélez Sarsfield', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 424, home: 'Rosario Central', away: 'Platense', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 425, home: 'Deportivo Riestra', away: 'Instituto', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 426, home: 'Huracán', away: 'Central Córdoba', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 427, home: 'Independiente Rivadavia', away: 'Banfield', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 428, home: 'Unión', away: 'Defensa y Justicia', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 429, home: 'Racing', away: 'Aldosivi', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 21, home: 'Talleres', away: 'River Plate', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 430, home: 'Tigre', away: 'Barracas Central', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 431, home: 'Argentinos Jrs', away: 'Newell\'s', date: '19/10', time: '14:00', jornada: 13, result: null }, { id: 432, home: 'Boca Jrs.', away: 'Belgrano', date: '19/10', time: '14:00', jornada: 13, result: null },

            // JORNADA 14
            { id: 433, home: 'Banfield', away: 'Lanús', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 23, home: 'Vélez Sarsfield', away: 'Talleres', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 434, home: 'River Plate', away: 'Gimnasia', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 24, home: 'Platense', away: 'Sarmiento', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 435, home: 'Instituto', away: 'Rosario Central', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 436, home: 'San Lorenzo', away: 'Deportivo Riestra', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 437, home: 'Independiente', away: 'Atlético Tucumán', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 22, home: 'Godoy Cruz', away: 'San Martín SJ', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 38, home: 'Estudiantes', away: 'Boca Jrs.', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 438, home: 'Belgrano', away: 'Tigre', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 439, home: 'Barracas Central', away: 'Argentinos Jrs', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 440, home: 'Newell\'s', away: 'Unión', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 37, home: 'Defensa y Justicia', away: 'Huracán', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 441, home: 'Central Córdoba', away: 'Racing', date: '02/11', time: '14:00', jornada: 14, result: null }, { id: 442, home: 'Aldosivi', away: 'Independiente Rivadavia', date: '02/11', time: '14:00', jornada: 14, result: null },

            // JORNADA 15
            { id: 443, home: 'Boca Jrs.', away: 'River Plate', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 25, home: 'Atlético Tucumán', away: 'Godoy Cruz', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 39, home: 'San Martín SJ', away: 'Lanús', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 40, home: 'Rosario Central', away: 'San Lorenzo', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 444, home: 'Deportivo Riestra', away: 'Independiente', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 27, home: 'Sarmiento', away: 'Instituto', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 26, home: 'Talleres', away: 'Platense', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 18, home: 'Gimnasia', away: 'Vélez Sarsfield', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 445, home: 'Banfield', away: 'Aldosivi', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 16, home: 'Independiente Rivadavia', away: 'Central Córdoba', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 426, home: 'Huracán', away: 'Newell\'s', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 429, home: 'Racing', away: 'Defensa y Justicia', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 428, home: 'Unión', away: 'Barracas Central', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 431, home: 'Argentinos Jrs', away: 'Belgrano', date: '09/11', time: '14:00', jornada: 15, result: null }, { id: 430, home: 'Tigre', away: 'Estudiantes', date: '09/11', time: '14:00', jornada: 15, result: null },

            // JORNADA 16
            { id: 446, home: 'Vélez Sarsfield', away: 'River Plate', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 447, home: 'Platense', away: 'Gimnasia', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 41, home: 'San Lorenzo', away: 'Sarmiento', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 30, home: 'Aldosivi', away: 'San Martín SJ', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 29, home: 'Instituto', away: 'Talleres', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 448, home: 'Independiente', away: 'Rosario Central', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 28, home: 'Godoy Cruz', away: 'Deportivo Riestra', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 19, home: 'Lanús', away: 'Atlético Tucumán', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 432, home: 'Boca Jrs.', away: 'Tigre', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 415, home: 'Belgrano', away: 'Unión', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 439, home: 'Barracas Central', away: 'Huracán', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 422, home: 'Estudiantes', away: 'Argentinos Jrs', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 440, home: 'Newell\'s', away: 'Racing', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 37, home: 'Defensa y Justicia', away: 'Independiente Rivadavia', date: '16/11', time: '14:00', jornada: 16, result: null }, { id: 441, home: 'Central Córdoba', away: 'Banfield', date: '16/11', time: '14:00', jornada: 16, result: null },
        ];
        
        let initialAnnualTableData = [
            { pos: 1, team: 'River Plate', pts: 49, pj: 24, pg: 13, pe: 10, pp: 1, gf: 37, gc: 14, dg: 23 }, { pos: 2, team: 'Boca Jrs.', pts: 46, pj: 24, pg: 13, pe: 7, pp: 4, gf: 34, gc: 15, dg: 19 }, { pos: 3, team: 'Rosario Central', pts: 46, pj: 23, pg: 12, pe: 10, pp: 1, gf: 27, gc: 11, dg: 16 }, { pos: 4, team: 'Argentinos Jrs', pts: 41, pj: 24, pg: 11, pe: 8, pp: 5, gf: 31, gc: 17, dg: 14 }, { pos: 5, team: 'Barracas Central', pts: 41, pj: 24, pg: 11, pe: 8, pp: 5, gf: 31, gc: 26, dg: 5 }, { pos: 6, team: 'Deportivo Riestra', pts: 40, pj: 24, pg: 10, pe: 10, pp: 4, gf: 24, gc: 12, dg: 12 }, { pos: 7, team: 'Huracán', pts: 39, pj: 24, pg: 10, pe: 9, pp: 5, gf: 24, gc: 18, dg: 6 }, { pos: 8, team: 'San Lorenzo', pts: 39, pj: 24, pg: 10, pe: 9, pp: 5, gf: 19, gc: 15, dg: 4 }, { pos: 9, team: 'Tigre', pts: 36, pj: 24, pg: 10, pe: 6, pp: 8, gf: 24, gc: 19, dg: 5 }, { pos: 10, team: 'Racing', pts: 35, pj: 24, pg: 11, pe: 2, pp: 11, gf: 34, gc: 28, dg: 6 }, { pos: 11, team: 'Independiente Rivadavia', pts: 35, pj: 24, pg: 9, pe: 8, pp: 7, gf: 28, gc: 27, dg: 1 }, { pos: 12, team: 'Lanús', pts: 33, pj: 24, pg: 8, pe: 9, pp: 7, gf: 20, gc: 18, dg: 2 }, { pos: 13, team: 'Estudiantes', pts: 33, pj: 24, pg: 9, pe: 6, pp: 9, gf: 27, gc: 29, dg: -2 }, { pos: 14, team: 'Independiente', pts: 32, pj: 23, pg: 8, pe: 8, pp: 7, gf: 27, gc: 20, dg: 7 }, { pos: 15, team: 'Platense', pts: 32, pj: 23, pg: 8, pe: 8, pp: 7, gf: 20, gc: 20, dg: 0 }, { pos: 16, team: 'Central Córdoba', pts: 31, pj: 24, pg: 8, pe: 7, pp: 9, gf: 31, gc: 28, dg: 3 }, { pos: 17, team: 'Defensa y Justicia', pts: 31, pj: 24, pg: 8, pe: 7, pp: 9, gf: 27, gc: 29, dg: -2 }, { pos: 18, team: 'Unión', pts: 29, pj: 24, pg: 7, pe: 8, pp: 9, gf: 24, gc: 23, dg: 1 }, { pos: 19, team: 'Vélez Sarsfield', pts: 29, pj: 24, pg: 8, pe: 5, pp: 11, gf: 16, gc: 25, dg: -9 }, { pos: 20, team: 'Newell\'s', pts: 28, pj: 24, pg: 7, pe: 7, pp: 10, gf: 20, gc: 23, dg: -3 }, { pos: 21, team: 'Banfield', pts: 27, pj: 24, pg: 7, pe: 6, pp: 11, gf: 23, gc: 29, dg: -6 }, { pos: 22, team: 'Instituto', pts: 27, pj: 24, pg: 7, pe: 6, pp: 11, gf: 20, gc: 30, dg: -10 }, { pos: 23, team: 'Belgrano', pts: 26, pj: 24, pg: 5, pe: 11, pp: 8, gf: 19, gc: 30, dg: -11 }, { pos: 24, team: 'Gimnasia', pts: 26, pj: 24, pg: 7, pe: 5, pp: 12, gf: 15, gc: 26, dg: -11 }, { pos: 25, team: 'Atlético Tucumán', pts: 25, pj: 24, pg: 7, pe: 4, pp: 13, gf: 25, gc: 29, dg: -4 }, { pos: 26, team: 'Sarmiento', pts: 24, pj: 23, pg: 4, pe: 12, pp: 7, gf: 18, gc: 28, dg: -10 }, { pos: 27, team: 'Godoy Cruz', pts: 24, pj: 24, pg: 4, pe: 12, pp: 8, gf: 15, gc: 28, dg: -13 }, { pos: 28, team: 'Talleres', pts: 19, pj: 24, pg: 3, pe: 10, pp: 11, gf: 14, gc: 23, dg: -9 }, { pos: 29, team: 'San Martín SJ', pts: 18, pj: 24, pg: 4, pe: 6, pp: 14, gf: 10, gc: 25, dg: -15 }, { pos: 30, team: 'Aldosivi', pts: 18, pj: 24, pg: 4, pe: 6, pp: 14, gf: 19, gc: 38, dg: -19 }
        ];

        let initialPromediosData = [
            { pos: 1, team: 'River Plate', prom: 1.943, pts: 204, pj: 105, s23: 85, s24: 70, s25: 49 }, { pos: 2, team: 'Boca Jrs.', prom: 1.667, pts: 175, pj: 105, s23: 62, s24: 67, s25: 46 }, { pos: 3, team: 'Racing', prom: 1.557, pts: 165, pj: 106, s23: 60, s24: 70, s25: 35 }, { pos: 4, team: 'Rosario Central', prom: 1.519, pts: 158, pj: 104, s23: 65, s24: 47, s25: 46 }, { pos: 5, team: 'Estudiantes', prom: 1.505, pts: 158, pj: 105, s23: 62, s24: 63, s25: 33 }, { pos: 6, team: 'Argentinos Jrs', prom: 1.486, pts: 156, pj: 105, s23: 54, s24: 56, s25: 41 }, { pos: 7, team: 'Talleres', prom: 1.505, pts: 158, pj: 105, s23: 67, s24: 72, s25: 19 }, { pos: 8, team: 'Vélez Sarsfield', prom: 1.453, pts: 154, pj: 106, s23: 49, s24: 76, s25: 29 }, { pos: 9, team: 'Huracán', prom: 1.434, pts: 152, pj: 106, s23: 51, s24: 62, s25: 39 }, { pos: 10, team: 'San Lorenzo', prom: 1.406, pts: 149, pj: 106, s23: 64, s24: 45, s25: 39 }, { pos: 11, team: 'Godoy Cruz', prom: 1.429, pts: 150, pj: 105, s23: 63, s24: 64, s25: 24 }, { pos: 12, team: 'Lanús', prom: 1.406, pts: 149, pj: 106, s23: 57, s24: 59, s25: 33 }, { pos: 13, team: 'Independiente', prom: 1.404, pts: 146, pj: 104, s23: 51, s24: 63, s25: 32 }, { pos: 14, team: 'Defensa y Justicia', prom: 1.400, pts: 147, pj: 105, s23: 58, s24: 58, s25: 31 }, { pos: 15, team: 'Deportivo Riestra', prom: 1.354, pts: 88, pj: 65, s23: 0, s24: 48, s25: 40 }, { pos: 16, team: 'Platense', prom: 1.365, pts: 142, pj: 104, s23: 54, s24: 57, s25: 32 }, { pos: 17, team: 'Barracas Central', prom: 1.343, pts: 141, pj: 105, s23: 49, s24: 49, s25: 41 }, { pos: 18, team: 'Unión', prom: 1.257, pts: 132, pj: 105, s23: 46, s24: 60, s25: 29 }, { pos: 19, team: 'Independiente Rivadavia', prom: 1.246, pts: 81, pj: 65, s23: 0, s24: 46, s25: 35 }, { pos: 20, team: 'Belgrano', prom: 1.245, pts: 132, pj: 106, s23: 57, s24: 49, s25: 26 }, { pos: 21, team: 'Instituto', prom: 1.257, pts: 132, pj: 105, s23: 52, s24: 53, s25: 27 }, { pos: 22, team: 'Newell\'s', prom: 1.226, pts: 130, pj: 106, s23: 53, s24: 49, s25: 28 }, { pos: 23, team: 'Atlético Tucumán', prom: 1.217, pts: 129, pj: 106, s23: 54, s24: 50, s25: 25 }, { pos: 24, team: 'Tigre', prom: 1.162, pts: 122, pj: 105, s23: 47, s24: 39, s25: 36 }, { pos: 25, team: 'Central Córdoba', prom: 1.142, pts: 121, pj: 106, s23: 48, s24: 42, s25: 31 }, { pos: 26, team: 'Gimnasia', prom: 1.133, pts: 119, pj: 105, s23: 45, s24: 48, s25: 26 }, { pos: 27, team: 'Banfield', prom: 1.143, pts: 120, pj: 105, s23: 53, s24: 41, s25: 27 }, { pos: 28, team: 'Sarmiento', prom: 0.990, pts: 103, pj: 104, s23: 46, s24: 35, s25: 24 }, { pos: 29, team: 'Aldosivi', prom: 0.750, pts: 18, pj: 24, s23: 0, s24: 0, s25: 18 }, { pos: 30, team: 'San Martín SJ', prom: 0.750, pts: 18, pj: 24, s23: 0, s24: 0, s25: 18 },
        ];
        
        let annualTableData = [];
        let promediosTableData = [];
        let baseTableForSim;
        let basePromediosForSim;
        const headerTeams = ['Talleres', 'Aldosivi', 'San Martín SJ'];

        // --- UTILS ---
        const getTeamInitials = (teamName) => teamColors[teamName]?.initials || teamName;
        const getDayOfWeek = (dateString) => { const [d, m] = dateString.split('/'); const date = new Date(2025, m - 1, d); return isNaN(date.getTime()) ? '' : ['DOM','LUN','MAR','MIÉ','JUE','VIE','SÁB'][date.getDay()]; };
        const getTeamColorDiv = (teamName) => {
            const c = teamColors[teamName]; if (!c) return `<div class="color-indicator" style="background-color: transparent; border: 1px solid #ccc;"></div>`;
            const style = `--color1: ${c.primary}; --color2: ${c.secondary};` + (c.tertiary ? ` --color3: ${c.tertiary};` : '');
            return `<div class="color-indicator ${c.type === 'single' ? 'team-color-single' : `color-${c.type}`}" style="${style}"></div>`;
        };
        const renderTeamDisplay = (teamName, alignClass = '', isFixture = false) => {
            const fontSizeClass = isFixture ? 'text-lg' : 'text-sm';
            return `<div class="flex items-center gap-2 ${alignClass}">${getTeamColorDiv(teamName)}<span class="font-bold ${fontSizeClass} text-white">${getTeamInitials(teamName)}</span></div>`;
        };
        
        // --- RENDER FUNCTIONS ---
        const renderFilterButtons = () => {
            const container = document.getElementById('filter-buttons-container');
            let buttonsHTML = `<button class="team-filter-btn" onclick="filterMatches('All')">Todos</button>`;
            headerTeams.forEach(team => {
                buttonsHTML += `<button class="team-filter-btn flex items-center justify-center" onclick="filterMatches('${team}')">${getTeamColorDiv(team)}${getTeamInitials(team)}</button>`;
            });
            container.innerHTML = buttonsHTML;
        };

        const renderFixtureSubTabs = () => {
            const container = document.getElementById('fixture-sub-tabs-container');
            container.innerHTML = '';
            const jornadas = [...new Set(allMatches.map(m => m.jornada))].sort((a,b) => a-b);
            jornadas.forEach(j => {
                 container.innerHTML += `<button class="sub-tab-btn text-sm" onclick="showFixtureByDate(${j}, this)">Fecha ${j}</button>`
            });
        };

        const renderMatches = (matchesToRender) => {
            const body = document.getElementById('fixture-body'); body.innerHTML = '';
            if (matchesToRender.length === 0) { body.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-slate-400">No hay partidos para mostrar.</td></tr>`; return; }
            matchesToRender.forEach(match => {
                const isHeaderMatch = headerTeams.includes(match.home) || headerTeams.includes(match.away);
                const row = body.insertRow();
                row.className = 'hover:bg-slate-800/60 cursor-pointer' + (isHeaderMatch && document.querySelector('.team-filter-btn.active').getAttribute('onclick').includes('All') ? ' bg-blue-900/40' : '');
                row.setAttribute('onclick', `event.target.tagName.toLowerCase() !== 'input' && toggleDetails('details-${match.id}')`);
                const homeScore = match.result ? match.result.split('-')[0] : '';
                const awayScore = match.result ? match.result.split('-')[1] : '';
                row.innerHTML = `
                    <td class="py-3 text-left text-slate-300">${renderTeamDisplay(match.home, '', true)}</td>
                    <td class="py-3 text-center">
                       <div class="flex justify-center items-center gap-1">
                            <input id="home-score-${match.id}" type="number" min="0" value="${homeScore}" oninput="updateResult(${match.id})"
                                   class="w-10 h-10 p-2 text-center font-bold text-lg border-2 border-slate-600 rounded-md bg-slate-900 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input id="away-score-${match.id}" type="number" min="0" value="${awayScore}" oninput="updateResult(${match.id})"
                                   class="w-10 h-10 p-2 text-center font-bold text-lg border-2 border-slate-600 rounded-md bg-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </td>
                    <td class="py-3 text-right text-slate-300">${renderTeamDisplay(match.away, 'justify-end', true)}</td>
                    <td class="py-3 text-center text-slate-400">${getDayOfWeek(match.date)} ${match.date}</td>
                    <td class="py-3 text-center text-slate-400">${match.time}</td>
                    <td class="py-3 text-center text-slate-400 text-lg">&#9662;</td>
                `;
                const detailsRow = body.insertRow();
                detailsRow.id = `details-${match.id}`;
                detailsRow.className = 'hidden';
                detailsRow.innerHTML = `<td colspan="6" class="px-6 py-4 details-panel"><h4 class="font-bold mb-2">Detalles del Partido</h4><p><strong>Partido:</strong> ${match.home} vs ${match.away}</p><p><strong>Torneo:</strong> Liga Profesional</p></td>`;
            });
        };

        const renderAnnualTable = () => {
            const body = document.getElementById('annual-table-body'); body.innerHTML = '';
            
            const sortedPromedios = [...promediosTableData].sort((a, b) => a.prom - b.prom);
            const lastPromedioTeam = sortedPromedios.length > 0 ? sortedPromedios[0].team : null;
            const lastAnnualTeam = annualTableData.length > 0 ? annualTableData[annualTableData.length - 1].team : null;
            
            let relegatedByAnnual;
            if (lastPromedioTeam && lastAnnualTeam && lastPromedioTeam === lastAnnualTeam) {
                relegatedByAnnual = annualTableData.length > 1 ? annualTableData[annualTableData.length - 2].team : null;
            } else {
                relegatedByAnnual = lastAnnualTeam;
            }

            annualTableData.forEach((team, index) => {
                const row = body.insertRow();
                let rowClass = '';
                if (index <= 2) { rowClass = 'bg-yellow-500/10'; } 
                else if (index >= 3 && index <= 8) { rowClass = 'bg-gray-500/10'; }
                if (team.team === relegatedByAnnual) { rowClass = 'bg-red-900/40 text-red-300';}
                row.className = rowClass;
                const dgClass = team.dg > 0 ? 'text-green-400' : (team.dg < 0 ? 'text-red-400' : 'text-slate-400');
                row.innerHTML = `
                    <td class="px-2 py-3 font-semibold text-center text-slate-400">${index + 1}</td>
                    <td class="px-2 py-3 text-left text-slate-300">${renderTeamDisplay(team.team)}</td>
                    <td class="px-2 py-3 font-bold text-center text-white">${team.pts}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.pj}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pg}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pe}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pp}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gf}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gc}</td>
                    <td class="px-2 py-3 font-semibold text-center ${dgClass}">${team.dg}</td>
                `;
            });
        };

        const renderTalleresTable = () => {
            const body = document.getElementById('talleres-table-body'); body.innerHTML = '';
            const lastTen = annualTableData.slice(-10);
            
            const sortedPromedios = [...promediosTableData].sort((a, b) => a.prom - b.prom);
            const lastPromedioTeam = sortedPromedios.length > 0 ? sortedPromedios[0].team : null;
            const lastAnnualTeamInFull = annualTableData.length > 0 ? annualTableData[annualTableData.length - 1].team : null;
            let relegatedByAnnual;
            if (lastPromedioTeam && lastAnnualTeamInFull && lastPromedioTeam === lastAnnualTeamInFull) {
                relegatedByAnnual = annualTableData.length > 1 ? annualTableData[annualTableData.length - 2].team : null;
            } else {
                relegatedByAnnual = lastAnnualTeamInFull;
            }

            lastTen.forEach((team) => {
                const row = body.insertRow();
                if(team.team === relegatedByAnnual) {
                    row.className = 'bg-red-900/40 text-red-300';
                }
                 const dgClass = team.dg > 0 ? 'text-green-400' : (team.dg < 0 ? 'text-red-400' : 'text-slate-400');
                row.innerHTML = `
                    <td class="px-2 py-3 font-semibold text-center text-slate-400">${team.pos}</td>
                    <td class="px-2 py-3 text-left text-slate-300">${renderTeamDisplay(team.team)}</td>
                    <td class="px-2 py-3 font-bold text-center text-white">${team.pts}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.pj}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pg}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pe}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.pp}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gf}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.gc}</td>
                    <td class="px-2 py-3 font-semibold text-center ${dgClass}">${team.dg}</td>
                `;
            });
        };

        const renderPromediosTable = () => {
            const body = document.getElementById('promedios-table-body'); body.innerHTML = '';
            promediosTableData.sort((a,b) => b.prom - a.prom);
            promediosTableData.forEach((team, index) => {
                const row = body.insertRow();
                if (index + 1 === 30) {
                    row.className = 'bg-red-900/40 text-red-300';
                }
                row.innerHTML = `
                    <td class="px-2 py-3 font-semibold text-center text-slate-400">${index + 1}</td>
                    <td class="px-2 py-3 text-left text-slate-300">${renderTeamDisplay(team.team)}</td>
                    <td class="px-2 py-3 font-bold text-center text-white">${team.prom.toFixed(3)}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.pts}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.pj}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.s23}</td>
                    <td class="hidden sm:table-cell px-2 py-3 text-center text-slate-400">${team.s24}</td>
                    <td class="px-2 py-3 text-center text-slate-400">${team.s25}</td>
                `;
            });
        };

        // --- LOGIC & EVENT HANDLERS ---
        window.updateResult = (matchId) => {
            const match = allMatches.find(m => m.id == matchId);
            if (!match) return;
            const homeScore = document.getElementById(`home-score-${match.id}`).value;
            const awayScore = document.getElementById(`away-score-${match.id}`).value;
            if (homeScore.trim() !== '' && awayScore.trim() !== '') {
                match.result = `${homeScore}-${awayScore}`;
            } else {
                match.result = null;
            }
            recalculateTables();
        };

        window.restoreResults = () => {
            allMatches.forEach(match => {
                match.result = null;
            });
            const activeFilterBtn = document.querySelector('.team-filter-btn.active');
            const activeTeamFilter = activeFilterBtn.getAttribute('onclick').match(/'(.*?)'/)[1];

            if (activeTeamFilter === 'All') {
                const activeSubTab = document.querySelector('.sub-tab-btn.active');
                if (activeSubTab) {
                    const jornada = parseInt(activeSubTab.textContent.split(' ')[1]);
                    showFixtureByDate(jornada, activeSubTab);
                } else {
                    showFixtureByDate(8, document.querySelector('.sub-tab-btn'));
                }
            } else {
                const filtered = allMatches.filter(m => (m.home === activeTeamFilter || m.away === activeTeamFilter));
                renderMatches(filtered);
            }
            recalculateTables();
            localStorage.removeItem('savedMatches');
        };

        window.saveResults = () => {
            const resultsToSave = allMatches.filter(m => m.result).map(m => ({id: m.id, result: m.result}));
            localStorage.setItem('savedMatches', JSON.stringify(resultsToSave));
            alert('Resultados guardados!');
        };
        
        const recalculateTables = () => {
            let tempAnnualTable = JSON.parse(JSON.stringify(initialAnnualTableData));
            allMatches.forEach(match => {
                if (match.result) { 
                    const [homeScore, awayScore] = match.result.split('-').map(Number);
                    const homeTeam = tempAnnualTable.find(t => t.team === match.home);
                    const awayTeam = tempAnnualTable.find(t => t.team === match.away);
                    if (homeTeam && awayTeam) {
                        homeTeam.pj += 1; awayTeam.pj += 1;
                        homeTeam.gf += homeScore; awayTeam.gf += awayScore;
                        homeTeam.gc += awayScore; awayTeam.gc += homeScore;
                        if (homeScore > awayScore) { homeTeam.pg += 1; homeTeam.pts += 3; awayTeam.pp += 1; } 
                        else if (awayScore > homeScore) { awayTeam.pg += 1; awayTeam.pts += 3; homeTeam.pp += 1; } 
                        else { homeTeam.pe += 1; awayTeam.pe += 1; homeTeam.pts += 1; awayTeam.pts += 1; }
                    }
                }
            });
            tempAnnualTable.forEach(team => { team.dg = team.gf - team.gc; });
            annualTableData = tempAnnualTable;
            annualTableData.sort((a, b) => b.pts - a.pts || (b.dg - a.dg) || (b.gf - a.gf));
            annualTableData.forEach((team, index) => team.pos = index + 1);

            let tempPromedios = JSON.parse(JSON.stringify(initialPromediosData));
            annualTableData.forEach(annualTeam => {
                const promedioTeam = tempPromedios.find(p => p.team === annualTeam.team);
                if(promedioTeam) {
                    promedioTeam.s25 = annualTeam.pts;
                    promedioTeam.pts = promedioTeam.s23 + promedioTeam.s24 + promedioTeam.s25;
                    promedioTeam.pj = initialPromediosData.find(p => p.team === annualTeam.team).pj - initialAnnualTableData.find(p => p.team === annualTeam.team).pj + annualTeam.pj;
                    if (promedioTeam.pj > 0) {
                        promedioTeam.prom = promedioTeam.pts / promedioTeam.pj;
                    } else {
                        promedioTeam.prom = 0;
                    }
                }
            });
            promediosTableData = tempPromedios;
            
            renderAnnualTable();
            renderTalleresTable();
            renderPromediosTable();
        };
        
        window.toggleDetails = (id) => document.getElementById(id)?.classList.toggle('hidden');
        
        window.filterMatches = (team) => {
            const subTabs = document.getElementById('fixture-sub-tabs-container');
            document.querySelectorAll('.team-filter-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.team-filter-btn[onclick="filterMatches('${team}')"]`);
            if(btn) btn.classList.add('active');
            
            if(team === 'All') {
                subTabs.style.display = 'flex';
                if(!subTabs.hasChildNodes()){
                    renderFixtureSubTabs();
                }
                const firstFutureJornada = Math.min(...allMatches.map(m => m.jornada));
                const firstSubTab = document.querySelector(`.sub-tab-btn[onclick="showFixtureByDate(${firstFutureJornada}, this)"]`);
                if(firstSubTab) {
                   firstSubTab.click();
                }
            } else {
                subTabs.style.display = 'none';
                const filtered = allMatches.filter(m => (m.home === team || m.away === team));
                renderMatches(filtered);
            }
        };

        window.showFixtureByDate = (jornada, btn) => {
             document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
             btn.classList.add('active');
             const filtered = allMatches.filter(m => m.jornada === jornada);
             renderMatches(filtered);
        };

        window.showTab = (tabId, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('active'); });
            btn.classList.add('active');
        };
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedResults = JSON.parse(localStorage.getItem('savedMatches'));
            if(savedResults) {
                savedResults.forEach(saved => {
                    const match = allMatches.find(m => m.id === saved.id);
                    if(match) {
                        match.result = saved.result;
                    }
                });
            }

            baseTableForSim = JSON.parse(JSON.stringify(initialAnnualTableData));
            basePromediosForSim = JSON.parse(JSON.stringify(initialPromediosData));

            renderFilterButtons();
            recalculateTables(); 

            const fixtureTabBtn = document.querySelector('.tab-btn');
            showTab('fixture-container', fixtureTabBtn);
            filterMatches('All');
        });
    </script>
</body>
</html>

